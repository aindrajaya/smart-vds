const vulnerabilityDetectors = require('./utils/vulnerabilityDetectors')

module.exports = {
  // Scanner function that runs all vulnerability detectors for a given parse tree
  vulnerabilityScanner: async (parseTree) => {
    const vulnerabilitiesDetected = []

    // Scan for unchecked call return value vulnerability
    const uncheckedCallReturnValue = await vulnerabilityDetectors.detectUncheckedCallReturnValue(parseTree)

    if (uncheckedCallReturnValue[0] === true) {
      vulnerabilitiesDetected.push(['UNCHECKED_CALL_RETURN_VALUE', uncheckedCallReturnValue[1]])
    }

    // Display count and details of vulnerabilities found
    console.log('Vulnerabilities Detected: ', vulnerabilitiesDetected.length)
    console.log('Vulnerabilities: ')
    for (let i = 0; i < vulnerabilitiesDetected.length; i++) {
      console.log(vulnerabilitiesDetected[i][0])
      console.log(vulnerabilitiesDetected[i][1])
    }
  }
}
